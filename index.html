<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Quiz Generator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Lora:wght@400;600&display=swap"
    rel="stylesheet"
  />
  <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai@^0.12.0"
      }
    }
  </script>

  <style>
    :root {
      --primary-color: #005f73;
      --secondary-color: #0a9396;
      --background-color: #e9d8a6;
      --card-bg-color: #ee9b00;
      --text-color: #001219;
      --light-text-color: #ffffff;
      --correct-bg: #e9f5db;
      --correct-border: #94d2bd;
      --correct-text: #005f73;
      --incorrect-bg: #ffeded;
      --incorrect-border: #ae2012;
      --incorrect-text: #ae2012;
      --border-radius: 12px;
      --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Poppins", sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }
    #app-container {
      width: 100%;
      max-width: 800px;
      background: var(--card-bg-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
    }
    header {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: var(--light-text-color);
      padding: 20px;
      text-align: center;
    }
    h1 { font-weight: 700; }
    main { padding: 30px; }
    .screen { display: none; flex-direction: column; align-items: center; text-align: center; }
    .screen.active { display: flex; }
    h2 { margin-bottom: 15px; font-weight: 600; color: var(--primary-color); }
    h3 { margin-bottom: 20px; font-weight: 600; text-align: center; }
    p { margin-bottom: 20px; line-height: 1.6; }
    button {
      padding: 12px 25px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      color: var(--light-text-color);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 20px;
    }
    button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
    input[type="text"] {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #ddd;
      font-size: 16px;
      margin-top: 10px;
    }
    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(0,0,0,0.1);
      border-top-color: var(--secondary-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    #passage-container {
      background-color: #fff3e0;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 30px;
      font-family: "Lora", serif;
      line-height: 1.7;
      border: 1px solid #ffeccc;
    }
    .question-item { margin-bottom: 25px; text-align: left; }
    .question-text { font-weight: 600; margin-bottom: 15px; }
    .options-group .option {
      display: flex;
      align-items: center;
      background-color: #fff;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 8px;
      border: 2px solid #ddd;
      cursor: pointer;
      transition: border-color 0.2s, background-color 0.2s;
    }
    .options-group .option:hover { border-color: var(--secondary-color); }
    .options-group .option input[type="radio"] { margin-right: 12px; accent-color: var(--primary-color); }
    textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 2px solid #ddd;
      font-family: "Poppins", sans-serif;
      font-size: 16px;
      resize: vertical;
      transition: border-color 0.2s;
    }
    textarea:focus { outline: none; border-color: var(--secondary-color); }
    #feedback-container { margin-top: 20px; display: flex; flex-direction: column; gap: 15px; text-align: left; }
    .feedback-item { padding: 15px; border-radius: var(--border-radius); border: 2px solid; }
    .feedback-item.correct { background-color: var(--correct-bg); border-color: var(--correct-border); }
    .feedback-item.incorrect { background-color: var(--incorrect-bg); border-color: var(--incorrect-border); }
    .option-result { padding: 8px; border-radius: 6px; margin-bottom: 5px; }
    .option-result.correct-answer { background-color: var(--correct-border); color: var(--correct-text); font-weight: 600; }
    .option-result.wrong-answer { background-color: var(--incorrect-border); color: var(--light-text-color); text-decoration: line-through; }
    .explanation, .user-answer { font-size: 0.9em; margin-top: 10px; background: rgba(255,255,255,0.4); padding: 10px; border-radius: 6px; }
  </style>
</head>
<body>
  <div id="app-container">
    <header><h1>AI Quiz Generator</h1></header>
    <main id="main-content">
      <div id="setup-screen" class="screen active">
        <h2>Enter a topic to generate your quiz!</h2>
        <p>For example: Climate Change, SpaceX, AI, Global Politics</p>
        <input type="text" id="topic-input" placeholder="Enter your topic here" />
        <button id="start-btn">Generate Quiz</button>
      </div>
      <div id="loading-screen" class="screen">
        <div class="spinner"></div>
        <p id="loading-text">Generating your quiz...</p>
      </div>
      <div id="reading-screen" class="screen">
        <h3>Read the passage and answer the questions.</h3>
        <div id="passage-container"></div>
        <div id="qa-container">
          <div id="questions-container"></div>
          <div id="written-question-container"></div>
          <button id="submit-btn">Submit Answers</button>
        </div>
      </div>
      <div id="results-screen" class="screen">
        <h2 id="score-heading"></h2>
        <div id="feedback-container"></div>
        <button id="play-again-btn">Play Again</button>
      </div>
    </main>
  </div>

  <script type="module">
    import { GoogleGenAI } from "@google/genai";

    const ai = new GoogleGenAI({ apiKey: "AIzaSyApYIGkB2NLHGo3KcEpO-kYnSyBeDVtZ1M" });

    const appState = { currentScreen: "setup", passage: "", questions: [], writtenQuestion: null, results: null };
    const screens = { setup: document.getElementById("setup-screen"), loading: document.getElementById("loading-screen"), reading: document.getElementById("reading-screen"), results: document.getElementById("results-screen") };
    const elements = {
      startBtn: document.getElementById("start-btn"),
      submitBtn: document.getElementById("submit-btn"),
      playAgainBtn: document.getElementById("play-again-btn"),
      loadingText: document.getElementById("loading-text"),
      passageContainer: document.getElementById("passage-container"),
      questionsContainer: document.getElementById("questions-container"),
      writtenQuestionContainer: document.getElementById("written-question-container"),
      scoreHeading: document.getElementById("score-heading"),
      feedbackContainer: document.getElementById("feedback-container"),
    };

    function switchScreen(screenName) { Object.values(screens).forEach(s => s.classList.remove("active")); screens[screenName].classList.add("active"); appState.currentScreen = screenName; }

    async function generateQuiz() {
      const topic = document.getElementById("topic-input").value.trim();
      if (!topic) { alert("Please enter a topic!"); return; }
      switchScreen("loading");
      elements.loadingText.textContent = `Generating quiz on "${topic}"...`;

      try {
        const prompt = `
          Generate a short informative paragraph about "${topic}".
          Then create 5 multiple-choice questions with 4 options each, and correct answer, based on that paragraph.
          Also create 1 open-ended question.
          Respond ONLY in JSON format like this:
          {
            "passage": "paragraph text",
            "questions": [
              {"question": "...", "options": ["...","...","...","..."], "correctAnswer": "...", "explanation":"..."}
            ],
            "writtenQuestion": {"question": "..."}
          }`;
        const response = await ai.models.generateContent({ model: "gemini-2.5-flash", contents: prompt, config: { responseMimeType: "application/json" } });
        const data = JSON.parse(response.text);
        appState.passage = data.passage;
        appState.questions = data.questions;
        appState.writtenQuestion = data.writtenQuestion;
        renderReadingScreen();
        switchScreen("reading");
      } catch (err) { console.error(err); alert("Error generating quiz. Try again."); switchScreen("setup"); }
    }

    function renderReadingScreen() {
      elements.passageContainer.textContent = appState.passage;
      elements.questionsContainer.innerHTML = "";
      appState.questions.forEach((mcq, i) => {
        const q = document.createElement("div");
        q.classList.add("question-item");
        q.innerHTML = `<p class="question-text">${i + 1}. ${mcq.question}</p>
          <div class="options-group">${mcq.options.map(opt => `<div class="option"><input type="radio" name="q${i}" value="${opt}"> ${opt}</div>`).join("")}</div>`;
        elements.questionsContainer.appendChild(q);
      });
      elements.writtenQuestionContainer.innerHTML = `<div class="question-item"><p class="question-text">${appState.questions.length + 1}. ${appState.writtenQuestion.question}</p><textarea id="written-answer" rows="4" placeholder="Type your answer..."></textarea></div>`;
    }

    function collectUserAnswers() {
      const mcqAnswers = appState.questions.map((_, i) => { const sel = document.querySelector(`input[name="q${i}"]:checked`); return sel ? sel.value : null; });
      const written = document.getElementById("written-answer").value;
      return { mcqAnswers, written };
    }

    function evaluateAnswers() {
      const { mcqAnswers, written } = collectUserAnswers();
      switchScreen("loading"); elements.loadingText.textContent = "Evaluating answers...";
      let score = 0;
      const mcqFeedback = appState.questions.map((q, i) => { const isCorrect = mcqAnswers[i] === q.correctAnswer; if (isCorrect) score++; return { ...q, userAnswer: mcqAnswers[i], isCorrect }; });
      const writtenFeedback = { question: appState.writtenQuestion.question, userAnswer: written, feedback: "AI feedback not implemented in demo.", isCorrect: false };
      appState.results = { score, total: appState.questions.length, mcqFeedback, writtenFeedback };
      renderResultsScreen(); switchScreen("results");
    }

    function renderResultsScreen() {
      const { score, total, mcqFeedback, writtenFeedback } = appState.results;
      elements.scoreHeading.textContent = `You scored ${score} out of ${total}!`;
      elements.feedbackContainer.innerHTML = "";
      mcqFeedback.forEach(item => {
        const div = document.createElement("div");
        div.classList.add("feedback-item", item.isCorrect ? "correct" : "incorrect");
        div.innerHTML = `<h4>${item.question}</h4><ul>${item.options.map(opt => `<li class="option-result ${opt === item.correctAnswer ? "correct-answer" : opt === item.userAnswer && !item.isCorrect ? "wrong-answer" : ""}">${opt}</li>`).join("")}</ul><p><strong>Feedback:</strong> ${item.explanation}</p>`;
        elements.feedbackContainer.appendChild(div);
      });
      const writtenDiv = document.createElement("div");
      writtenDiv.classList.add("feedback-item");
      writtenDiv.innerHTML = `<h4>${writtenFeedback.question}</h4><p><strong>Your Answer:</strong> ${writtenFeedback.userAnswer}</p><p><strong>Feedback:</strong> ${writtenFeedback.feedback}</p>`;
      elements.feedbackContainer.appendChild(writtenDiv);
    }

    function resetApp() { appState.passage = ""; appState.questions = []; appState.writtenQuestion = null; appState.results = null; document.getElementById("topic-input").value = ""; switchScreen("setup"); }

    elements.startBtn.addEventListener("click", generateQuiz);
    elements.submitBtn.addEventListener("click", evaluateAnswers);
    elements.playAgainBtn.addEventListener("click", resetApp);
  </script>
</body>
</html>

